# This pipeline creates an artifact of a runnable Mvc site if the Blog Template

name: $(Date:yyyyMMdd)$(Rev:-r)
pool:
  vmImage: "windows-latest"

pr:
  branches:
    include:
      - develop
      - feature/*

trigger:
  branches:
    include:
      - main
      - develop

steps:
  - task: UseDotNet@2
    displayName: use netcoreapp3.1 sdk
    inputs:
      version: "3.1.x"
      performMultiLevelLookup: true

  - task: UseDotNet@2
    displayName: use net5.0 sdk
    inputs:
      version: "5.0.x"
      performMultiLevelLookup: true

  - task: UseDotNet@2
    displayName: use net6.0 sdk
    inputs:
      version: "6.0.x"

  - task: DotNetCoreCLI@2
    displayName: "restore dependencies"
    inputs:
      command: "restore"
      projects: "src/src/Mvc/App/BlogTemplate.Mvc.App.csproj"

  # NOTE: MSBuild executes npm build tasks for us
  - task: DotNetCoreCLI@2
    displayName: "build mvc"
    inputs:
      command: "build"
      projects: "src/src/Mvc/App/BlogTemplate.Mvc.App.csproj"
      arguments: "-c Release --no-restore"

  - task: DotNetCoreCLI@2
    displayName: "create deployable"
    inputs:
      command: "publish"
      publishWebProjects: false
      projects: "src/src/Mvc/App/BlogTemplate.Mvc.App.csproj"
      arguments: '-c Release -o "$(build.artifactstagingdirectory)" --no-build'

  - task: PublishBuildArtifacts@1
    displayName: "publish artifact"
    inputs:
      PathtoPublish: "$(build.artifactstagingdirectory)"
      ArtifactName: "blogtemplate-mvc"
